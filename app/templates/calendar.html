{% extends "dashboard_base.html" %}

{% block title %}Calendar{% endblock %}

{% block extra_css %}
<style>
    .calendar-grid {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: 1px;
        background: var(--border);
        border: 1px solid var(--border);
        border-radius: var(--radius);
        overflow: hidden;
    }
    .calendar-header {
        background: var(--dark);
        color: white;
        padding: 0.75rem;
        text-align: center;
        font-weight: 600;
        font-size: 0.8rem;
    }
    .calendar-day {
        background: white;
        min-height: 100px;
        padding: 0.5rem;
        vertical-align: top;
    }
    .calendar-day.other-month {
        background: #f8fafc;
        color: #94a3b8;
    }
    .calendar-day.today {
        background: rgba(99, 102, 241, 0.05);
    }
    .day-number {
        font-weight: 600;
        font-size: 0.85rem;
        margin-bottom: 0.25rem;
    }
    .today .day-number {
        background: var(--primary);
        color: white;
        width: 24px;
        height: 24px;
        border-radius: 50%;
        display: inline-flex;
        align-items: center;
        justify-content: center;
    }
    .calendar-event {
        font-size: 0.7rem;
        padding: 0.2rem 0.4rem;
        margin-bottom: 0.2rem;
        border-radius: 4px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        cursor: pointer;
    }
    .calendar-event:hover {
        opacity: 0.9;
    }
    .calendar-event.completed {
        opacity: 0.6;
        text-decoration: line-through;
    }
    .calendar-nav {
        display: flex;
        align-items: center;
        gap: 1rem;
    }
    .calendar-nav h2 {
        min-width: 200px;
        text-align: center;
        margin: 0;
    }
</style>
{% endblock %}

{% block content %}
<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
    <h1 class="h2">Calendar</h1>
    <div class="calendar-nav">
        <a href="{{ url_for('calendar', year=prev_year, month=prev_month) }}" class="btn btn-sm btn-outline-secondary">
            <span data-feather="chevron-left"></span>
        </a>
        <h2 class="h4">{{ month_name }} {{ year }}</h2>
        <a href="{{ url_for('calendar', year=next_year, month=next_month) }}" class="btn btn-sm btn-outline-secondary">
            <span data-feather="chevron-right"></span>
        </a>
        <a href="{{ url_for('calendar') }}" class="btn btn-sm btn-outline-primary ms-2">Today</a>
    </div>
</div>

<div class="calendar-grid">
    <!-- Day headers -->
    <div class="calendar-header">Sun</div>
    <div class="calendar-header">Mon</div>
    <div class="calendar-header">Tue</div>
    <div class="calendar-header">Wed</div>
    <div class="calendar-header">Thu</div>
    <div class="calendar-header">Fri</div>
    <div class="calendar-header">Sat</div>

    <!-- Calendar days -->
    {% for day in calendar_days %}
    <div class="calendar-day {% if not day.current_month %}other-month{% endif %} {% if day.is_today %}today{% endif %}">
        <div class="day-number">{{ day.day }}</div>
        {% for event in day.events %}
        <div class="calendar-event {% if event.status == 'completed' %}completed{% endif %}"
             title="{{ event.title }}{% if event.class_name %} - {{ event.class_name }}{% endif %}"
             style="background: {{ event.class_color }}20; color: {{ event.class_color }}; border-left: 2px solid {{ event.class_color }};">
            {{ event.title }}
        </div>
        {% endfor %}
    </div>
    {% endfor %}
</div>

<!-- Legend -->
<div class="mt-3">
    <small class="text-muted">Events are colored to match their class color</small>
</div>
{% endblock %}

{% block scripts %}
<script>
    feather.replace();
</script>
{% endblock %}
